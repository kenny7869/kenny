# 系統資源查看

## ps (Process status) 指令

可利用 ps 將某個時間點的程序運作情況擷取下來

**選項與參數：**

- -A：所有的 process 均顯示出來，與 -e 具有同樣的效用
- -a：不與 terminal 有關的所有 process 
- -u：有效使用者 (effective user) 相關的 process
- x：通常與 a 這個參數一起使用，可列出較完整資訊

**輸出格式規劃：**

- l：較長、較詳細的將該 PID 的的資訊列出
- j：工作的格式 (jobs format)
- -f：做一個更為完整的輸出
  
以下這行指令可利用 ps 指令列出行程的一些基本資訊，按照每個行程所使用的記憶體排序後，列出排名最前面的幾個行程，也就是列出系統上最耗費記憶體的程式：

```sh
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head
```

這裡的 `-e` 參數是代表輸出所有行程的資訊，而 `-o` 參數則是用來指定輸出欄位用的，後面接著所有想要輸出的欄位名稱，這裡我們讓 ps 輸出以下幾個欄位：

- pid：行程 ID（process ID）
- ppid：父行程 ID（parent process ID）
- cmd：程式名稱
- %mem：記憶體使用量（百分比）
- %cpu：CPU 使用量（百分比）

而 `--sort` 參數則是指定排序的依據欄位，預設會依照數值由小到大排序，若要由大到小的方式排序的話，可以在欄位名稱前加上一個負號，依上述例子，排序的欄位指定為`-%mem`，這樣就可以依照記憶體使用量，從大到小排序
最後將 ps 的輸出以 Linux 管線（pipe）導向至 head，決定要保留前幾行的資料，其餘的都丟棄

若要找出系統上最耗費 CPU 的程式，也是使用類似的指令，只是在排序時，將排序的欄位換成 CPU 使用量

```sh
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head
```

## top 指令

`top` 指令是一個互動式（interactive）的工具，可以顯示即時的系統負載狀態，而它也可以用於指令稿中，輸出各種系統資訊。

以下這行指令可將系統行程以記憶體的使用賴排序後，以 batch 模式輸出報表，並且指定保留前幾個最耗費記憶體的行程

```sh
top -b -o +%MEM | head -n 17
```

其中 `-b` 參數是 batch 模式的意思，而 `-o` 參數則是設定以記憶體用量來排序行程，最後面的 `head -n 17` 則是篩選 top 輸出的文字內容，只保留前 17 行

若要找出最耗費 CPU 資源的行程，則改用 CPU 使用量來排序即可，如下：

```sh
top -b -o +%CPU | head -n 17
```

