(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{460:function(t,a,e){"use strict";e.r(a);var s=e(43),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"ssl-sni"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-sni"}},[t._v("#")]),t._v(" SSL SNI")]),t._v(" "),e("h2",{attrs:{id:"何謂sni-server-name-indication"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#何謂sni-server-name-indication"}},[t._v("#")]),t._v(" 何謂SNI（Server Name Indication）")]),t._v(" "),e("p",[t._v("SNI（Server Name Indication）是為了解決一台伺服器使用多個域名和證書的 SSL/TLS 的技術，在 SSLv3/TLSv1 中被啓用，要使用 SNI，需要用戶端和伺服器端同時滿足條件，幸好對於現代瀏覽器來說，大部分都支持 SSLv3/TLSv1，所以都可以享受 SNI 帶來的便利")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("以前的 SSL 憑證無法多個域名使用同一組 IP ?")]),e("br"),t._v("\n早期的 SSLv2 根據經典的公鑰基礎設施 PKI(Public Key Infrastructure) 設計，它預設值為：一台伺服器（或者說一個IP）只會提供一個服務，所以在 SSL 握手時，伺服器端可以確認客戶端申請的是哪張證書，但是讓人萬萬沒有想到的是，虛擬主機快速的蓬勃發展 ，就造成了一個 IP 會對應多個域名的情況。"),e("br"),e("br"),t._v("\nSNI技術中，在 HTTP 協議中，請求的網域名稱作為表頭（Host）放在 HTTP Header 中，所以伺服器端知道應該把請求引向哪個網域名稱，但是早期的 SSL 做不到這一點，因為在 SSL 握手的過程中，根本不會有 Host 的信息，所以伺服器端通常返回的是配置中的第一個可用憑證。因而一些較老的環境，可能會產生多個網域名稱分別配好了憑證後，但返回的始終是同一個。"),e("br"),e("br"),t._v("\nSNI並非可以適用於所有的狀況，還是有條件限制的，若要知道你目前使用的憑證是否可以使用SNI技術，需要從用戶端及伺服器端兩個部分來看，相對的伺服器端比較容易解決，如果是用戶端就難一點，當然你可以在網站上告訴用戶，請用戶升級他們的瀏覽器版本。")])]),t._v(" "),e("h2",{attrs:{id:"apache-設定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apache-設定"}},[t._v("#")]),t._v(" Apache 設定")]),t._v(" "),e("p",[e("strong",[t._v("apache httpd 2.2.12 版本之後，單一 IP 可不需裝其它模組即可安裝多張 SSL 憑證")])]),t._v(" "),e("ul",[e("li",[t._v("在 "),e("code",[t._v("/etc/httpd/conf.d/ssl.conf")]),t._v(" 設定檔裡去做設定")])]),t._v(" "),e("ol",[e("li",[t._v("首先找到 "),e("code",[t._v("VirtualHost _default_:443")]),t._v("註解掉，在這個設定的上方增加設定值"),e("code",[t._v("NameVirtualHost *:443")]),t._v("，如此一來，才可以讓 Apache 辨認 domain name 來區分，然後再將")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("NameVirtualHost *:443\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#<VirtualHost _default_:443>")]),t._v("\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("編輯 "),e("code",[t._v("VirtualHost")]),t._v(" 區塊")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("VirtualHost *:44"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("3")]),t._v(">")]),t._v("\nServerName www.aaa.com.tw\nSSLEngine on\nSSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1\nSSLCipherSuite HIGH:MED\nSSLCACertificateFile  /etc/ssl/ca_bundle.crt\nSSLCertificateKeyFile /etc/ssl/private.key\nSSLCertificateFile    /etc/ssl/certificate.crt\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/VirtualHost"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("VirtualHost *:44"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("3")]),t._v(">")]),t._v("\nServerName www.bbb.com.tw\nSSLEngine on\nSSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1\nSSLCipherSuite HIGH:MED\nSSLCACertificateFile  /etc/ssl/ca_bundle_bbb.crt\nSSLCertificateKeyFile /etc/ssl/private_bbb.key\nSSLCertificateFile    /etc/ssl/certificate_bbb.crt\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("/VirtualHost"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);